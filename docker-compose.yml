version: '3.8'

services:
  face-recognition:
    build: .
    container_name: esp32cam-recognition
    restart: unless-stopped
    ports:
      - "${FLASK_PORT:-5000}:5000"
    volumes:
      # Montar el directorio de capturas para persistencia
      - ./capturas_registro:/app/capturas_registro
      # Montar frames capturados
      - ./captured_frames:/app/captured_frames
      - ./recognition_results:/app/recognition_results
      # Montar los archivos de datos para que persistan entre reinicios
      - ./encodings.npy:/app/encodings.npy
      - ./labels.json:/app/labels.json
    environment:
      # Variables requeridas
      - STREAM_URL=${STREAM_URL:-http://192.168.122.116:81/stream}
      - FLASK_PORT=${FLASK_PORT:-5000}
      - FLASK_ENV=${FLASK_ENV:-production}
      # Variables opcionales
      - NEXTJS_WEBHOOK_URL=${NEXTJS_WEBHOOK_URL:-}
      - FACIAL_RECOGNITION_WEBHOOK_SECRET=${FACIAL_RECOGNITION_WEBHOOK_SECRET:-}
      - AWS_REGION=${AWS_REGION:-us-east-1}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - DOWNSCALE=${DOWNSCALE:-0.5}
      - THRESHOLD=${THRESHOLD:-0.6}
      - AWS_SECRET_NAME=${AWS_SECRET_NAME:-}
    networks:
      - esp32cam-network

networks:
  esp32cam-network:
    driver: bridge

